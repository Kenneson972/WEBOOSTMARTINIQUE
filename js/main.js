// Script principal pour l'initialisation de LiquidEther
// Garantit que tout s'ex√©cute au bon moment

document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Initialisation du site WebBoost Martinique...');
    
    // Variables globales
    let liquidEther = null;
    
    // Fonction d'initialisation de LiquidEther
    function initLiquidEther() {
        try {
            // V√©rifier que LiquidEther est disponible
            if (typeof LiquidEther === 'undefined') {
                console.error('‚ùå LiquidEther non disponible');
                return false;
            }

            console.log('‚úÖ LiquidEther disponible, initialisation...');

            // Initialiser LiquidEther avec configuration optimis√©e
            liquidEther = new LiquidEther({
                color: '#9333ea',
                background: '#000000',
                density: 0.6,
                velocity: 0.4,
                size: 1.2,
                opacity: 0.7
            });

            console.log('‚úÖ LiquidEther initialis√© avec succ√®s !');
            return true;

        } catch (error) {
            console.error('‚ùå Erreur lors de l\'initialisation LiquidEther:', error);
            return false;
        }
    }

    // Gestion de la visibilit√© pour optimiser les performances
    function setupVisibilityHandling() {
        document.addEventListener('visibilitychange', function() {
            if (!liquidEther) return;
            
            if (document.hidden) {
                liquidEther.stop();
                console.log('‚è∏Ô∏è Animation LiquidEther mise en pause');
            } else {
                liquidEther.start();
                console.log('‚ñ∂Ô∏è Animation LiquidEther reprise');
            }
        });
    }

    // Gestion du redimensionnement de la fen√™tre
    function setupResizeHandling() {
        let resizeTimeout;
        window.addEventListener('resize', function() {
            if (!liquidEther) return;
            
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                console.log('üì± Redimensionnement d√©tect√©, recr√©ation des particules...');
                liquidEther.createParticles();
            }, 250);
        });
    }

    // Initialisation des animations de r√©v√©lation
    function initRevealAnimations() {
        const reveals = document.querySelectorAll('.reveal');
        
        const revealObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        });

        reveals.forEach(reveal => {
            revealObserver.observe(reveal);
        });

        console.log('‚úÖ Animations de r√©v√©lation initialis√©es');
    }

    // Initialisation de la navigation mobile
    function initMobileNavigation() {
        const navToggle = document.getElementById('navToggle');
        const mainNav = document.querySelector('.main-nav');

        if (navToggle && mainNav) {
            navToggle.addEventListener('click', function() {
                mainNav.classList.toggle('active');
                navToggle.classList.toggle('active');
            });

            // Fermer le menu lors du clic sur un lien
            const navLinks = mainNav.querySelectorAll('a');
            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    mainNav.classList.remove('active');
                    navToggle.classList.remove('active');
                });
            });

            console.log('‚úÖ Navigation mobile initialis√©e');
        }
    }

    // Initialisation des FAQ
    function initFAQ() {
        const faqItems = document.querySelectorAll('.faq-item');
        
        faqItems.forEach(item => {
            const question = item.querySelector('.faq-question');
            
            question.addEventListener('click', function() {
                // Fermer tous les autres √©l√©ments FAQ
                faqItems.forEach(otherItem => {
                    if (otherItem !== item) {
                        otherItem.classList.remove('active');
                    }
                });
                
                // Toggle l'√©l√©ment actuel
                item.classList.toggle('active');
            });
        });

        console.log('‚úÖ FAQ initialis√©es');
    }

    // Initialisation du formulaire de contact
    function initContactForm() {
        const contactForm = document.getElementById('contactForm');
        
        if (contactForm) {
            contactForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // R√©cup√©rer les donn√©es du formulaire
                const formData = new FormData(contactForm);
                const data = Object.fromEntries(formData);
                
                console.log('üìß Donn√©es du formulaire:', data);
                
                // Ici vous pouvez ajouter la logique d'envoi
                // Par exemple, un appel √† votre API
                
                // Message de confirmation temporaire
                const submitBtn = contactForm.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                
                submitBtn.innerHTML = '<span>Envoi en cours...</span>';
                submitBtn.disabled = true;
                
                setTimeout(() => {
                    submitBtn.innerHTML = '<span>Message envoy√© !</span><i class="fas fa-check"></i>';
                    
                    setTimeout(() => {
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                        contactForm.reset();
                    }, 3000);
                }, 2000);
            });

            console.log('‚úÖ Formulaire de contact initialis√©');
        }
    }

    // Fonction principale d'initialisation
    function init() {
        // Attendre un peu pour s'assurer que tout est charg√©
        setTimeout(() => {
            // Initialiser LiquidEther
            initLiquidEther();
            
            // Configurer les gestionnaires d'√©v√©nements
            setupVisibilityHandling();
            setupResizeHandling();
            
            // Initialiser les autres fonctionnalit√©s
            initRevealAnimations();
            initMobileNavigation();
            initFAQ();
            initContactForm();
            
            console.log('‚úÖ Site WebBoost Martinique enti√®rement initialis√© !');
        }, 300);
    }

    // D√©marrer l'initialisation
    init();
});
